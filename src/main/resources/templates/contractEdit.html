<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<div  th:fragment="contractEdit">
    
    <link th:href="@{99/css/plugins/ladda/ladda-themeless.min.css}" rel="stylesheet"/>
    <script th:src="@{jquery.koala.js}" type="text/javascript"></script>

    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2 th:text="${title}"></h2>
            <ol class="breadcrumb">
                <li>
                    <a href="index.html">首页</a>
                </li>
                <li>
                    <a>业务数据管理</a>
                </li>
                <li class="active">
                    <strong>合同管理</strong>
                </li>
            </ol>
        </div>
    </div>

    <div class="wrapper wrapper-content animated fadeInRight ecommerce">

        <div class="row">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <form method="POST" class="form-horizontal">
                            <input type="hidden" name="id" id="id" th:value="${contract}?${contract.id}"/>
                            <input type="hidden" name="hiddenCategoryValue" id="hiddenCategoryValue" th:value="${contract}?${contract.category}"/>
                            <input type="hidden" name="hiddenContractPaymentMethodValue" id="hiddenContractPaymentMethodValue" th:value="${contract}?${contract.contractPaymentMethod}"/>
                            <input type="hidden" name="hiddenFirstPartyValue" id="hiddenFirstPartyValue" th:value="${contract}?${contract.firstParty}"/>
                            <input type="hidden" name="hiddenSecondPartyValue" id="hiddenSecondPartyValue" th:value="${contract}?${contract.secondParty}"/>
                            <input type="hidden" name="hiddenProjectIdValue" id="hiddenProjectIdValue" th:value="${contract}?${contract.projectId}"/>
                            <div class="form-group" id="signDayForm">
                                <label class="col-sm-2 control-label">合同签署日期<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="signDay" name="signDay" type="text" readonly="readonly" th:value="${contract}?${contract.signDay}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="nameForm">
                                <label class="col-sm-2 control-label">合同名称<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="name" name="name" type="text" th:value="${contract}?${contract.name}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="codeForm">
                                <label class="col-sm-2 control-label">合同编号<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="code" name="code" type="text" readonly="readonly" th:value="${contract}?${contract.code}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="projectIdForm">
                                <label class="col-sm-2 control-label">项目编号<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="projectId" name="projectId" type="text" readonly="readonly" th:value="${contract}?${contract.projectCode}" th:attr="valueSetID=${contract}?${contract.projectId}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="projectNameForm">
                                <label class="col-sm-2 control-label">项目名称<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="projectName" name="projectName" placeholder="请选择项目名称" readonly="readonly" type="text" th:value="${contract}?${contract.projectName}"
                                                             class="form-control" maxlength="200" onclick="projectClick();" style="cursor:pointer;"/>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="campaignIdForm">
                                <label class="col-sm-2 control-label">市场活动<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="campaignId" name="campaignId" type="text" th:value="${contract}?${contract.campaignName}" th:attr="valueSetID=${contract}?${contract.campaignId}"
                                                             class="form-control" maxlength="200" readonly="readonly"/>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="exhibitionNumberForm">
                                <label class="col-sm-2 control-label">展位号<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="exhibitionNumber" name="exhibitionNumber" type="number" th:value="${contract}?${contract.exhibitionNumber}"
                                                             class="form-control"  oninput="if(value.length>30)value=value.slice(0,0)"/>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="areaForm">
                                <label class="col-sm-2 control-label">面积<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="area" name="area" type="text" th:value="${contract}?${contract.area}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="amountForm">
                                <label class="col-sm-2 control-label">合同总价<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="amount" name="amount" type="text" th:value="${contract}?${contract.amount}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="categoryForm">
                                <label class="col-sm-2 control-label">合同分类<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <select class="form-control m-b" name="category" id="category" onchange="categoryClick();">
                                        <option value="" selected="selected">未选择</option>
                                        <option value="C">销售合同</option>
                                        <option value="S">供应商合同-主办方</option>
                                        <option value="D">供应商合同-设计师</option>
                                        <option value="F">供应商合同-工厂</option>
                                        <option value="P">供应商合同-项目经理</option>
                                    </select>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="taxForm">
                                <label class="col-sm-2 control-label">税<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="tax" name="tax" type="text" th:value="${contract}?${contract.tax}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="contractPaymentMethodForm">
                                <label class="col-sm-2 control-label">付款方式
                                    <span style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <select class="form-control m-b" name="contractPaymentMethod" id="contractPaymentMethod">
                                        <option value="" selected="selected">未选择</option>
                                        <option value="5.5">5.5</option>
                                        <option value="7.3">7.3</option>
                                        <option value="6.4">6.4</option>
                                    </select>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="initialPaymentTimeForm">
                                <label class="col-sm-2 control-label">首付时间<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="initialPaymentTime" name="initialPaymentTime" type="text"  readonly="readonly" th:value="${contract}?${contract.initialPaymentTime}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="middlePaymentTimeForm">
                                <label class="col-sm-2 control-label">中款时间<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="middlePaymentTime" name="middlePaymentTime" type="text" readonly="readonly" th:value="${contract}?${contract.middlePaymentTime}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="finalPaymentTimeForm">
                                <label class="col-sm-2 control-label">尾款时间<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="finalPaymentTime" name="finalPaymentTime" type="text"  readonly="readonly" th:value="${contract}?${contract.finalPaymentTime}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="billingInfoForm">
                                <label class="col-sm-2 control-label">开票信息<span
                                    style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <input id="billingInfo" name="billingInfo" type="text" th:value="${contract}?${contract.billingInfo}"
                                                             class="form-control" maxlength="200" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="firstPartyForm">
                                <label class="col-sm-2 control-label">合同甲方<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <select class="form-control m-b" name="firstParty" id="firstParty">
                                        <option value="" selected="selected">未选择</option>
                                        <option th:value="${firstParty.id}" th:text="${firstParty.name}" th:each="firstParty:${firstPartyList}"></option>
                                    </select>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>
                            
                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="secondPartyForm">
                                <label class="col-sm-2 control-label">合同乙方<span
                                        style="color:#ed5565;">*</span></label>
                                <div class="col-sm-4">
                                    <select class="form-control m-b" name="secondParty" id="secondParty">
                                        <option value="" selected="selected">未选择</option>
                                        <option th:value="${secondParty.id}" th:text="${secondParty.name}" th:each="secondParty:${secondPartyList}"></option>
                                    </select>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group" id="ledgerInputForm">
                                <label class="col-sm-2 control-label">台账</label>
                                <div class="col-sm-4">
                                    <input id="ledgerInput" name="ledgerInput" type="text" th:value="${contract}?${contract.ledgerListInput}"
                                           class="form-control"  onclick="ledgerClick()" readonly="readonly" placeholder="请填写台账" style="cursor:pointer;"/>
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label">备注</label>
                                <div class="col-sm-4">
                                    <input id="remarks" name="remarks" type="text" th:value="${contract}?${contract.remarks}"
                                                             class="form-control" maxlength="15" />
                                </div>
                                <label class="col-sm-4 control-label" style="text-align: left"></label>
                            </div>

                            <div class="hr-line-dashed"></div>
                            <div class="form-group">
                                <div class="col-sm-4 col-sm-offset-2">
                                    <button id="saveBtn" class="btn ladda-button btn-w-m btn-primary" data-style="zoom-in" type="button" onclick="saveContract(this);">
                                        <span class="ladda-label">保&nbsp;&nbsp;存</span>
                                    </button>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--台账Modal-->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="ledgerModal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog " style="width:95%;"  role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 >台账填写</h3>
                </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-content">
                                    <div class="form-group" style="overflow-y:scroll;height:300px;">

                                        <div class="col-lg-12">
                                            <div class="row">
                                                <!--创建-->
                                                <table th:unless="${contract}?${contract.id}" class="table table-condensed" id="ledgerList">
                                                    <tr>
                                                        <td>
                                                            <div id="moneyType0Form">
                                                                    <label class="control-label">款项类型<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div >
                                                                        <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="moneyType" id="moneyType0">
                                                                            <option value="" selected="selected">未选择</option>
                                                                            <option th:value="${moneyType.id}" th:text="${moneyType.value}" th:each="moneyType:${moneyTypeList}"></option>
                                                                        </select>
                                                                    </div>
                                                                    <label class=" control-label" style="text-align: left"></label>
                                                                </div>
                                                        </td>
                                                        <td>
                                                            <div id="paymentMethod0Form">
                                                                    <label class="control-label">支付方式<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div>
                                                                        <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="paymentMethod" id="paymentMethod0">
                                                                            <option value="" selected="selected">未选择</option>
                                                                            <option th:value="${paymentMethod.id}" th:text="${paymentMethod.value}" th:each="paymentMethod:${paymentMethodList}"></option>
                                                                        </select>
                                                                    </div>
                                                                    <label class=" control-label" style="text-align: left"></label>
                                                                </div>
                                                        </td>
                                                        <td>
                                                            <div id="costCenter0Form">
                                                                    <label class="control-label">成本中心<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div>
                                                                        <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="costCenter" id="costCenter0">
                                                                            <option value="" selected="selected">未选择</option>
                                                                            <option th:value="${costCenter.id}" th:text="${costCenter.value}" th:each="costCenter:${costCenterList}"></option>
                                                                        </select>
                                                                    </div>
                                                                    <label class=" control-label" style="text-align: left"></label>
                                                                </div>
                                                        </td>
                                                        <td>
                                                            <div id="paymentTime0Form">
                                                                    <label class="control-label">付款时间<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div>
                                                                        <input type="text" name="paymentTime" id="paymentTime0" class="form-control input-sm" maxlength="50" readonly="readonly"/>
                                                                    </div>
                                                                    <label class="control-label" style="text-align: left"></label>
                                                                </div>
                                                        </td>
                                                        <td>
                                                            <div id="paymentAmount0Form">
                                                                    <label class="control-label">付款金额<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div>
                                                                        <input type="text"  name="paymentAmount" id="paymentAmount0" class="form-control input-sm" oninput="if(value.length>18)value=value.slice(0,18)"/>
                                                                    </div>
                                                                    <label class="control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div id="operator0Form">
                                                                    <label class="control-label">经办人<span
                                                                            style="color:#ed5565;">*</span></label>
                                                                    <div>
                                                                        <input type="text" name="operator" id="operator0" class="form-control input-sm" maxlength="30"/>
                                                                    </div>
                                                                    <label class="control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div id="reasonForChange0Form">
                                                                    <label class="control-label">变更原因</label>
                                                                    <div>
                                                                        <input type="text" name="reasonForChange" id="reasonForChange0" class="form-control input-sm" maxlength="50"/>
                                                                    </div>
                                                                    <label class=" control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td >
                                                            <button class="btn btn-primary btn-sm" type="button" style="width: 100%;margin-top: 23px;" onclick="add();">增&nbsp;&nbsp;加</button>
                                                        </td>
                                                    </tr>

                                                </table>
                                                <!--编辑-->
                                                <table th:if="${contract}?${contract.id}" class="table table-condensed" id="ledgerList">
                                                    <tr th:each="ledger,ledgerListStat : ${ledgerList}">
                                                        <td>
                                                            <div  th:attr="id='moneyType'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">款项类型<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div >
                                                                    <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="moneyType" th:attr="id='moneyType'+${ledgerListStat.index}" >
                                                                        <option value="" th:if="${contract}?${contract.id}" selected="selected">未选择</option>
                                                                        <option value="" th:unless="${contract}?${contract.id}" >未选择</option>
                                                                        <option th:value="${moneyType.id}" th:text="${moneyType.value}" th:each="moneyType:${moneyTypeList}" th:selected="${moneyType.id==ledger.moneyType?'selected':'false'}"></option>
                                                                    </select>
                                                                </div>
                                                                <label class=" control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='paymentMethod'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">支付方式<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div>
                                                                    <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="paymentMethod" th:attr="id='paymentMethod'+${ledgerListStat.index}">
                                                                        <option value="" th:if="${contract}?${contract.id}" selected="selected">未选择</option>
                                                                        <option value="" th:unless="${contract}?${contract.id}" >未选择</option>
                                                                        <option th:value="${paymentMethod.id}" th:text="${paymentMethod.value}" th:each="paymentMethod:${paymentMethodList}" th:selected="${paymentMethod.id==ledger.paymentMethod?'selected':'false'}"></option>
                                                                    </select>
                                                                </div>
                                                                <label class=" control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='costCenter'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">成本中心<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div>
                                                                    <select class="form-control input-sm" style="padding-top: 4px;width:95px;" name="costCenter" th:attr="id='costCenter'+${ledgerListStat.index}">
                                                                        <option value="" th:if="${contract}?${contract.id}" selected="selected">未选择</option>
                                                                        <option value="" th:unless="${contract}?${contract.id}" >未选择</option>
                                                                        <option th:value="${costCenter.id}" th:text="${costCenter.value}" th:each="costCenter:${costCenterList}" th:selected="${costCenter.id==ledger.costCenter?'selected':'false'}"></option>
                                                                    </select>
                                                                </div>
                                                                <label class=" control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='paymentTime'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">付款时间<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div>
                                                                    <input type="text" name="paymentTime" th:attr="id='paymentTime'+${ledgerListStat.index}" th:value="${ledger}?${ledger.paymentTime}"
                                                                           class="form-control input-sm" maxlength="50" readonly="readonly"/>
                                                                </div>
                                                                <label class="control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='paymentAmount'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">付款金额<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div>
                                                                    <input type="text"  name="paymentAmount" th:attr="id='paymentAmount'+${ledgerListStat.index}" th:value="${ledger}?${ledger.paymentAmount}"
                                                                           class="form-control input-sm" oninput="if(value.length>18)value=value.slice(0,18)"/>
                                                                </div>
                                                                <label class="control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='operator'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">经办人<span
                                                                        style="color:#ed5565;">*</span></label>
                                                                <div>
                                                                    <input type="text" name="operator" th:attr="id='operator'+${ledgerListStat.index}" th:value="${ledger}?${ledger.operator}"
                                                                           class="form-control input-sm" maxlength="30"/>
                                                                </div>
                                                                <label class="control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div th:attr="id='reasonForChange'+${ledgerListStat.index}+'Form'">
                                                                <label class="control-label" th:if="${ledgerListStat.index == 0}">变更原因</label>
                                                                <div>
                                                                    <input type="text" name="reasonForChange" th:attr="id='reasonForChange'+${ledgerListStat.index}" th:value="${ledger}?${ledger.reasonForChange}"
                                                                           class="form-control input-sm" maxlength="50"/>
                                                                </div>
                                                                <label class=" control-label" style="text-align: left"></label>
                                                            </div>
                                                        </td>
                                                        <td >
                                                            <button class="btn btn-primary btn-sm" th:if="${ledgerListStat.index == 0}" type="button" style="width: 100%;margin-top: 23px;" onclick="add();">增&nbsp;&nbsp;加</button>
                                                            <button class="btn btn-primary btn-sm" th:unless="${ledgerListStat.index == 0}"  th:attr="onclick='delBtnData(this)'" type="button" style="width: 100%;">删&nbsp;&nbsp;除</button>
                                                        </td>
                                                    </tr>

                                                </table>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                <div class="modal-footer">
                    <!--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
                    <button type="button" class="btn ladda-button btn-primary" onclick="checkLedgerInfo(this);"><span class="ladda-label">确定</span></button>
                </div>
            </div>
        </div>
    </div>
    <!--项目Modal-->
    <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" id="projectTableModal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog " role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 >请选择一个项目</h3>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-content">
                                <table id="projectTable" class="table table-striped table-bordered table-hover dataTables-example">
                                    <thead>
                                    <tr>
                                        <th>操作</th>
                                        <th>项目名称</th>
                                        <th>项目编号</th>
                                        <th>市场活动</th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                    <button type="button" class="btn ladda-button btn-primary" onclick="chooseProject(this);"><span class="ladda-label">确定</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Data picker -->
    <script th:src="@{99/js/plugins/datapicker/bootstrap-datepicker.js}"></script>
    <script th:src="@{99/js/plugins/ladda/spin.min.js}"></script>
    <script th:src="@{99/js/plugins/ladda/ladda.min.js}"></script>

     <!--Select2 -->
    <script th:src="@{99/js/plugins/select2/select2.full.min.js}"></script>

    <script th:src="@{me.js}" type="text/javascript"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var moneyTypeStr = "<option value=\"\" selected=\"selected\">未选择</option>";
        var paymentMethodStr = "<option value=\"\" selected=\"selected\">未选择</option>";
        var costCenterStr = "<option value=\"\" selected=\"selected\">未选择</option>";
        var moneyTypeList = /*[[${moneyTypeList}]]*/;
        if (moneyTypeList) {
            for (var a= 0;a < moneyTypeList.length;a++) {
                var moneyType = moneyTypeList[a];
                moneyTypeStr += '<option value="'+moneyType.id+'">'+moneyType.value+'</option>';
            }
        }

        var paymentMethodList = /*[[${paymentMethodList}]]*/;
        if (paymentMethodList) {
            for (var a= 0;a < paymentMethodList.length;a++) {
                var paymentMethod = paymentMethodList[a];
                paymentMethodStr += '<option value="'+paymentMethod.id+'">'+paymentMethod.value+'</option>';
            }
        }

        var costCenterList = /*[[${costCenterList}]]*/;
        if (costCenterList) {
            for (var a= 0;a < costCenterList.length;a++) {
                var costCenter = costCenterList[a];
                costCenterStr += '<option value="'+costCenter.id+'">'+costCenter.value+'</option>';
            }
        }

        // 编辑时台账Input的处理

        if(IsEdit()) $("#ledgerInput").val("已填写台账");
        function IsEdit() {
            var contractId = $("#id").val();
            var ledgerList = /*[[${ledgerList}]]*/;
            if(contractId && ledgerList.length > 0){
                return true;
            }
            return false;
        }
        /*]]>*/
    </script>

    <script type="text/javascript">
        /*<![CDATA[*/
        $("#contractEdit").addClass("active");
        var format = "yyyy-mm-dd";

        var AListStr = "<option value=\"\" selected=\"selected\">未选择</option>";
        var BListStr = "<option value=\"\" selected=\"selected\">未选择</option>";
        var projectTable = null;
        $(function () {
            datepickerInit("signDay",format);
            datepickerInit("initialPaymentTime",format);
            datepickerInit("middlePaymentTime",format);
            datepickerInit("finalPaymentTime",format);

            $('#projectTableModal').on('shown.bs.modal',function(){
                if(projectTable == undefined && projectTable == null){
                    projectTableInit();// 项目table初始化
                }
            })
//            // 台账list
//            ledgerInitList();

            // 各种验证
            validateSelect('signDay', 'signDay', 'validateSignDay');
            validate('name', 'name', 'validateContractName');
            validateSelect('code', 'code', 'validateContractCode');
            validateSelect('projectId', 'projectId', 'validateProjectId');
            validateSelect('projectName', 'projectName', 'validateProjectName');
            validateSelect('campaignId', 'campaignId', 'validateCampaignId');
            validate('exhibitionNumber', 'exhibitionNumber', 'validateExhibitionNumber');
            validate('area', 'area', 'validateArea');
            validate('amount', 'amount', 'validatAemount');
            validateSelect('category', 'category', 'validatCategory');
            validate('tax', 'tax', 'validatTax');
            validateSelect('contractPaymentMethod', 'contractPaymentMethod', 'validatContractPaymentMethod');
            validateSelect('initialPaymentTime', 'initialPaymentTime', 'validatInitialPaymentTime');
            validateSelect('middlePaymentTime', 'middlePaymentTime', 'validatMiddlePaymentTime');
            validateSelect('finalPaymentTime', 'finalPaymentTime', 'validatFinalPaymentTime');
            validate('billingInfo', 'billingInfo', 'validatBillingInfo');
            validateSelect('firstParty', 'firstParty', 'validatFirstParty');
            validateSelect('secondParty', 'secondParty', 'validatSecondParty');
            validateSelect('ledgerInput', 'ledgerInput', 'validatLedgerInput');

            // create ledger check
            validateSelect('moneyType0', 'moneyType', 'validatMoneyType');
            validateSelect('paymentMethod0', 'paymentMethod', 'validatPaymentMethod');
            validateSelect('costCenter0', 'costCenter', 'validatCostCenter');
            validateSelect('paymentTime0', 'paymentTime', 'validatPaymentTime');
            validate('paymentAmount0', 'paymentAmount', 'validatPaymentAmount');
            datepickerInit("paymentTime0",format);
            validate('operator0', 'operator', 'validatPerator');

            // 如果是编辑的话加载甲乙合同并选中
            var hiddenProjectIdValue = $("#hiddenProjectIdValue").val();
            if(hiddenProjectIdValue){
                getABList(hiddenProjectIdValue);
            }

            $("#category option").each(function(){
                if($(this).val() == ""){
                    $(this).attr("selected",false);
                }
                if($(this).val() == $("#hiddenCategoryValue").val()){
                    $(this).attr("selected",true);
                }
            });

            $("#contractPaymentMethod option").each(function(){
                if($(this).val() == ""){
                    $(this).attr("selected",false);
                }
                if($(this).val() == $("#hiddenContractPaymentMethodValue").val()){
                    $(this).attr("selected",true);
                }
            });

        })

        function datepickerInit(id,format) {
            $('#'+id).datepicker({
                startView: 1,
                todayBtn: "linked",
                keyboardNavigation: false,
                forceParse: false,
                autoclose: true,
                format: format,
                language: 'cn',
            });
        }

        /***
         *
         * 项目相关
         *
         **/
        function projectTableInit() {
            projectTable = $('#projectTable').DataTable({
                "sScrollX": true,
                "ajax": {
                    "url": "findProject",
                    "dataType": 'json',
                    "type": "POST",
                    contentType: 'application/json; charset=utf-8',

                    "data": function (d) {
                        var p = {};
                        p.draw = d.draw;
                        p.length = d.length;
                        p.start = d.start;
                        p.search = d.search.value;
                        var a = JSON.stringify(p);
                        return a;
                    }
                },

                "columns": [
                    {
                        "data": "id", "width": "50px",
                        "render": function (data, type, row) {
                            var u = "";
                            u =  "<input type=\"radio\" style=\"cursor:pointer;\" name='project' value='" + row.id + "' proName='" + row.name + "' proCode='" + row.code + "' " +
                                "proCampaignId='" + row.campaignId + "' proCampaignName='" + row.campaignName + "'/>";
                            return u;

                        },
                    },

                    {"data": "name", "width": "200px"},
                    {"data": "code", "width": "100px"},
                    {"data": "campaignName", "width": "100px"},
                ]
                , language: {
                    lengthMenu: '每页显示 <select class="form-control input-sm">'
                    + '<option value="20">20</option>'
                    + '<option value="40">40</option>'
                    + '<option value="100">100</option>'
                    + '</select> 个项目'
                    ,
                    processing: "载入中 ...",//处理页面数据的时候的显示
                    paginate: {//分页的样式文本内容。
                        previous: "上一页",
                        next: "下一页",
                        first: "第一页",
                        last: "最后一页"
                    },
                    "sSearch": "搜索",
                    zeroRecords: "没有用户",//table tbody内容为空时，tbody的内容。
                    //下面三者构成了总体的左下角的内容。
                    info: "当前显示第_START_到第_END_个用户 ，共_PAGES_ 页 ",//左下角的信息显示，大写的词为关键字。
                    infoEmpty: "0个用户",//筛选为空时左下角的显示。
                    infoFiltered: ""//筛选之后的左下角筛选提示(另一个是分页信息显示，在上面的info中已经设置，所以可以不显示)，
                }
                , "lengthChange": true
                , "bFilter": true //搜索栏
                , "bAutoWidth": true  //自适应宽度
                , "sPaginationType": "full_numbers" //分页，一共两种样式，full_numbers和two_button(默认)
                , "bJQueryUI": false //开关，是否启用JQueryUI风格
                , "bSort": false
                , "processing": true
                , "serverSide": true
                , "iDisplayLength": 20 //默认显示的记录数
            });
        }

        // 选择一个项目
        function chooseProject() {
            var project=document.getElementsByName("project");
            var projectId = "";
            $.each(project, function(i,v) {
                if(v.checked == true){
                    $("#projectId").val($(this).attr("proCode")); // 项目编号
                    $("#projectId").attr("valueSetID",$(this).val()); // 项目编号 ID

                    $("#projectName").val($(this).attr("proName")); // 项目名称

                    $("#campaignId").val($(this).attr("proCampaignName")); // 活动名
                    $("#campaignId").attr("valueSetID",$(this).attr("proCampaignId"));

                    projectId =  $("#projectId").attr("valueSetID");
                }
            });
            $("#projectId").change();
            $("#projectName").change();
            $("#campaignId").change();
            $("#code").val("");
            $("#code").change();
            $('#projectTableModal').modal('hide');
            getABList(projectId);
            $("#category option").each(function(){
                if($(this).val() == ""){
                    $(this).attr("selected",true);
                }
            });
            $("#category").change();
        }

        //甲方乙方列表
        function getABList(projectId) {
            if (projectId){
                $("#firstParty").empty();
                $("#secondParty").empty();
                var p = {
                    projectId: projectId
                };
//                var a = JSON.stringify(p);
                $.ajax({
                    url: '/getABList',
                    async: true,
                    type: 'POST',
                    data: p,
//                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    timeout: 300000,
                    beforeSend: function () {
                    },
                    error: function (result) {
                        alert("通信错误！");
                        $("#firstParty").html(ABListStr);
                        $("#secondParty").html(ABListStr);
                    },
                    success: function (data) {
                        if (data.ABList != "0"){
                            var hiddenFirstPartyValue = $("#hiddenFirstPartyValue").val();
                            var hiddenSecondPartyValue = $("#hiddenSecondPartyValue").val();
                            for (var a= 0;a < data.ABList.length;a++) {
                                var ab = data.ABList[a];
                                var stringBuilder = [];
                                stringBuilder.push("<option ");
                                stringBuilder.push(" value=");
                                stringBuilder.push("'");
                                stringBuilder.push(ab.id);
                                stringBuilder.push("'");
                                stringBuilder.push(ab.id == hiddenFirstPartyValue?"selected='selected'":null);
                                stringBuilder.push(">");
                                stringBuilder.push(ab.name);
                                stringBuilder.push("</option>");
                                AListStr += stringBuilder.join("");
                            }
                            for (var a= 0;a < data.ABList.length;a++) {
                                var ab = data.ABList[a];
                                var stringBuilder = [];
                                stringBuilder.push("<option ");
                                stringBuilder.push(" value=");
                                stringBuilder.push("'");
                                stringBuilder.push(ab.id);
                                stringBuilder.push("'");
                                stringBuilder.push(ab.id == hiddenSecondPartyValue?"selected='selected'":null);
                                stringBuilder.push(">");
                                stringBuilder.push(ab.name);
                                stringBuilder.push("</option>");
                                BListStr += stringBuilder.join("");
                            }
                        }
                        $("#firstParty").html(AListStr);
                        $("#secondParty").html(BListStr);
                    }
                });
            }
        }
        
        // show项目table
        function projectClick() {
            $('#projectTableModal').modal('show');
        }

        /***
         *
         * 合同分类
         *
         **/
        function categoryClick() {
            var projectCode = $("#projectId").val();
            var proName = $("#projectName").val();
            var type = $("#category").val();

            if (projectCode && proName && type){
                var p = {
                    code: projectCode,
                    type:type
                };
                var a = JSON.stringify(p);
                $.ajax({
                    url: '/getContractCode',
                    async: true,
                    type: 'POST',
                    data: a,
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    timeout: 300000,
                    beforeSend: function () {
                    },
                    error: function (result) {
                        alert("通信错误！");
                    },
                    success: function (data) {
                        $("#code").val(data.code);
                        $("#code").change();
                    }
                });
            }else {
                $("#code").val("");
                $("#code").change();
            }
        }

        /***
         *
         * 台账相关
         *
        **/
        // 添加台账
        function add() {
            var number = $("#ledgerList tr").length;
            var row ="<tr>\n" +
                "      <td>\n" +
                "          <div id=\"moneyType"+number+"Form\">\n" +
                "              <div >\n" +
                "                  <select class=\"form-control input-sm\" style=\"padding-top: 4px;width:95px;\" name=\"moneyType\" id=\"moneyType"+number+"\">\n" +
                "                      "+ moneyTypeStr +
                "                  </select>\n" +
                "              </div>\n" +
                "              <label class=\" control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"paymentMethod"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <select class=\"form-control input-sm\" style=\"padding-top: 4px;width:95px;\" name=\"paymentMethod\" id=\"paymentMethod"+number+"\">\n" +
                "                      "+ paymentMethodStr +
                "                  </select>\n" +
                "              </div>\n" +
                "              <label class=\" control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"costCenter"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <select class=\"form-control input-sm\" style=\"padding-top: 4px;width:95px;\" name=\"costCenter\" id=\"costCenter"+number+"\">\n" +
                "                      "+ costCenterStr +
                "                  </select>\n" +
                "              </div>\n" +
                "              <label class=\" control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"paymentTime"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <input type=\"text\" name=\"paymentTime\" id=\"paymentTime"+number+"\" class=\"form-control input-sm\" maxlength=\"50\" readonly=\"readonly\"/>\n" +
                "              </div>\n" +
                "              <label class=\"control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"paymentAmount"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <input type=\"text\"  name=\"paymentAmount\" id=\"paymentAmount"+number+"\" class=\"form-control input-sm\" oninput=\"if(value.length>18)value=value.slice(0,18)\"/>\n" +
                "              </div>\n" +
                "              <label class=\"control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"operator"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <input type=\"text\" name=\"operator\" id=\"operator"+number+"\" class=\"form-control input-sm\" maxlength=\"30\"/>\n" +
                "              </div>\n" +
                "              <label class=\"control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td>\n" +
                "          <div id=\"reasonForChange"+number+"Form\">\n" +
                "              <div>\n" +
                "                  <input type=\"text\" name=\"reasonForChange\" id=\"reasonForChange"+number+"\" class=\"form-control input-sm\" maxlength=\"50\"/>\n" +
                "              </div>\n" +
                "              <label class=\" control-label\" style=\"text-align: left\"></label>\n" +
                "          </div>\n" +
                "      </td>\n" +
                "      <td >\n" +
                "          <button class=\"btn btn-primary btn-sm\" onclick=\"delBtnData(this)\" type=\"button\" style=\"width: 100%;\" >删&nbsp;&nbsp;除</button>\n" +
                "      </td>\n" +
                "  </tr>";
            $("#ledgerList").append(row);

            validateSelect('moneyType'+number, 'moneyType', 'validatMoneyType');
            validateSelect('paymentMethod'+number, 'paymentMethod', 'validatPaymentMethod');
            validateSelect('costCenter'+number, 'costCenter', 'validatCostCenter');
            validateSelect('paymentTime'+number, 'paymentTime', 'validatPaymentTime');
            validate('paymentAmount'+number, 'paymentAmount', 'validatPaymentAmount');
            datepickerInit('paymentTime'+number,format);
            validate('operator'+number, 'operator', 'validatPerator');
            if(IsEdit()) validate('reasonForChange'+number, 'reasonForChange', 'validatReasonForChange');
            number++;

        }

        // 删除添加行
        function delBtnData(obj){
            $(obj).parent().parent().remove();
            updateId();
        }

        // 更新添加台账Form和input的Id
        function updateId() {
            $("#ledgerList tr").each(function(index){
                $(this).find($("div[id^='moneyType']")).attr("id","moneyType"+index+"Form");
                $(this).find($("select[id^='moneyType']")).attr("id","moneyType"+index);

                $(this).find($("div[id^='paymentMethod']")).attr("id","paymentMethod"+index+"Form");
                $(this).find($("select[id^='paymentMethod']")).attr("id","paymentMethod"+index);

                $(this).find($("div[id^='costCenter']")).attr("id","costCenter"+index+"Form");
                $(this).find($("select[id^='costCenter']")).attr("id","costCenter"+index);

                $(this).find($("div[id^='paymentTime']")).attr("id","paymentTime"+index+"Form");
                $(this).find($("input[id^='paymentTime']")).attr("id","paymentTime"+index);
                $(this).find($("div[id^='paymentAmount']")).attr("id","paymentAmount"+index+"Form");
                $(this).find($("input[id^='paymentAmount']")).attr("id","paymentAmount"+index);
                $(this).find($("div[id^='operator']")).attr("id","operator"+index+"Form");
                $(this).find($("input[id^='operator']")).attr("id","operator"+index);

                $(this).find($("div[id^='reasonForChange']")).attr("id","reasonForChange"+index+"Form");
                $(this).find($("input[id^='reasonForChange']")).attr("id","reasonForChange"+index);

            })
        }

        function ledgerClick() {
            $('#ledgerModal').modal('show');
        }

        // 加载台账3个list
//        function ledgerInitList() {
//            $.ajax({
//                url: 'ledgerInitList',
//                async: true,
//                type: 'POST',
////                data: a,
//                contentType: 'application/json; charset=utf-8',
//                dataType: 'json',
//                timeout: 300000,
//                beforeSend: function () {
//                },
//                error: function (result) {
//                    alert("通信错误！");
//                },
//                success: function (data) {
//                    if (data.moneyTypeList) {
//                        for (var a= 0;a < data.moneyTypeList.length;a++) {
//                            var moneyType = data.moneyTypeList[a];
//                            moneyTypeStr += '<option value="'+moneyType.id+'">'+moneyType.value+'</option>';
//                        }
//                        $("#moneyType0").html(moneyTypeStr);
//                    }
//                    if (data.paymentMethodList) {
//                        for (var a= 0;a < data.paymentMethodList.length;a++) {
//                            var paymentMethod = data.paymentMethodList[a];
//                            paymentMethodStr += '<option value="'+paymentMethod.id+'">'+paymentMethod.value+'</option>';
//                        }
//                        $("#paymentMethod0").html(paymentMethodStr);
//                    }
//                    if (data.costCenterList) {
//                        for (var a= 0;a < data.costCenterList.length;a++) {
//                            var costCenter = data.costCenterList[a];
//                            costCenterStr += '<option value="'+costCenter.id+'">'+costCenter.value+'</option>';
//                        }
//                        $("#costCenter0").html(costCenterStr);
//                    }
//                }
//            });
//        }

        // 台账后台验证
        function checkLedgerInfo() {
            var ledgerList = [];
            $("#ledgerList tr").each(function(index){
                moneyType = $(this).find("select[name=moneyType]").val();
                paymentMethod = $(this).find("select[name=paymentMethod]").val();
                costCenter = $(this).find("select[name=costCenter]").val();
                paymentTime = $(this).find("input[name=paymentTime]").val();
                paymentAmount = $(this).find("input[name=paymentAmount]").val();
                operator = $(this).find("input[name=operator]").val();
                reasonForChange = $(this).find("input[name=reasonForChange]").val();
                ledgerList.push({
                    "moneyType":moneyType,
                    "paymentMethod":paymentMethod,
                    "costCenter":costCenter,
                    "paymentTime":paymentTime,
                    "paymentAmount":paymentAmount,
                    "operator":operator,
                    "reasonForChange":reasonForChange
                })
            })
            var p = {
                ledgerList: ledgerList
            };
            var a = JSON.stringify(p);
            $.ajax({
                url: IsEdit() == true ? 'checkLedgerInfo2':'checkLedgerInfo',
                async: true,
                type: 'POST',
                data: a,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                timeout: 300000,
                beforeSend: function () {
                },
                error: function (result) {
                    alert("通信错误！");
                },
                success: function (data) {
                    if (data.res == undefined) {
                        for (var p in data) {
                            for (var p in data) {
                                var tempField = data[p].field;
                                if(tempField.startsWith("ledgerList[")){
                                    data[p].field= tempField.split(".")[1]+tempField.substring(tempField.indexOf("[")+1,tempField.indexOf("]"));
                                }
                                var tmp = $("#" + data[p].field).parent().next();

                                if (tmp.text() == '') {
                                    $("#" + data[p].field + "Form").addClass("has-error")
                                    var tmp = $("#" + data[p].field).parent().next();
                                    tmp.html(data[p].defaultMessage);
                                }
                            }
                        }
                        $("#ledgerListInput").val("")
                        ledgerList = [];
                    }else{
                        $("#ledgerInput").val("已填写台账");
                        $("#ledgerInput").change();
                        $('#ledgerModal').modal('hide');
                    }
                }
            });
            return ledgerList;
        }

        var saveBtnda;
        function saveContract(btn) {
            saveBtnda = Ladda.create( btn );

            // 编辑的是检查变更原因是否有空的。
            if(IsEdit()){
                var led = checkLedgerInfo();
                if(led.length > 0){
                    var rFlag = false;
                    for (var i = 0;i<led.length;i++){
                        var reasonForChange = led[i].reasonForChange;
                        if (reasonForChange == "" || reasonForChange == undefined || reasonForChange == null){
                            rFlag = true;
                            break;
                        }
                    }
                    if(rFlag){
                        $("#ledgerInput").val("");
                    }
                }
            }
            var p = {
                id: $("#id").val().trim(),
                signDay: $("#signDay").val().trim(),
                name: $("#name").val().trim(),
                code: $("#code").val().trim(),
                projectId: $("#projectId").attr("valueSetID"),
                projectName:$("#projectName").val(),
                campaignId: $("#campaignId").attr("valueSetID"),
                exhibitionNumber: $("#exhibitionNumber").val().trim(),
                area: $("#area").val().trim(),
                amount: $("#amount").val().trim(),
                category: $("#category").val().trim(),
                tax: $("#tax").val().trim(),
                contractPaymentMethod: $("#contractPaymentMethod").val().trim(),
                initialPaymentTime: $("#initialPaymentTime").val().trim(),
                middlePaymentTime: $("#middlePaymentTime").val().trim(),
                finalPaymentTime: $("#finalPaymentTime").val().trim(),
                billingInfo: $("#billingInfo").val().trim(),
                firstParty: $("#firstParty").val().trim(),
                secondParty: $("#secondParty").val().trim(),
                remarks: $("#remarks").val().trim(),

                ledgerListInput: checkLedgerInfo(),
                ledgerInput:$("#ledgerInput").val().trim()
            };
            var a = JSON.stringify(p);
            $.ajax({
                url: 'saveContract',
                async: true,
                type: 'POST',
                data: a,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                timeout: 300000,
                beforeSend: function () {
                    saveBtnda.start();
                },
                error: function (result) {
                    alert("通信错误！");
                    saveBtnda.stop();
                },
                success: function (data) {
                    if (data.res == undefined) {
                        saveBtnda.stop();
                        for (var p in data) {
                            var tmp = $("#" + data[p].field).parent().next();

                            if (tmp.text() == '') {
                                $("#" + data[p].field + "Form").addClass("has-error")
                                var tmp = $("#" + data[p].field).parent().next();
                                tmp.html(data[p].defaultMessage);
                            }
                        }
                    }else{

                        loadPage("contractList",function(){
                            saveBtnda.stop();
                        });
                    }
                }
            });
        }
        /*]]>*/
    </script>
</div>
</html>
